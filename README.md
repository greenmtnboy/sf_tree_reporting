# SF Tree Reporting

An interactive browser-based map of San Francisco's urban forest. Explore approximately 10,000 street trees by location, species, and ecological attributes.

**[Live page](https://greenmtnboy.github.io/sf_tree_reporting/)**

---

## What it does

The application loads San Francisco street tree records into an in-browser DuckDB instance and renders them on a MapLibre GL map. Tree display adapts across zoom levels:

- At low zoom: per-category heatmaps show density
- At medium zoom: colored circles scaled to trunk diameter
- At close zoom: silhouette icons by tree category (palm, broadleaf, spreading, coniferous, columnar, ornamental)

Clicking a tree opens a popup with its common name, species, planting date, trunk diameter, site description, and enriched species data (native status, evergreen status, mature height, bloom season, wildlife value, fire risk).

The sidebar lists San Francisco landmarks with a search filter; clicking one flies the map camera to that location.

A chat panel (requires an Anthropic API key entered at runtime) accepts natural language questions about the tree dataset. The assistant can query trees using Trilogy/PreQL, filter the map to show a subset of trees, and navigate the camera to locations by name or coordinate.

---

## Data sources

**Tree inventory**
SF Open Data Portal — SF Street Trees dataset (ID: `tkzw-k3nq`)
https://data.sfgov.org/City-Infrastructure/Street-Tree-List/tkzw-k3nq

Raw tree records are downloaded as CSV and converted to Parquet via `data/raw/tree_info.py`.

**Species enrichment**
Per-species attributes (native status, evergreen, mature height, canopy spread, growth rate, lifespan, drought tolerance, bloom season, wildlife value, fire risk, tree category, map icon) are generated by `data/raw/tree_enrichment.py`. For each species, text is collected from:

- Wikipedia REST API and MediaWiki API
- Plants of the World Online (POWO / Kew) — powo.science.kew.org
- World Flora Online (WFO) — list.worldfloraonline.org

Structured fields are extracted from that text using Google Gemini 2.5 Pro (via `instructor` + `litellm`) and written to Parquet. The enrichment Parquet is served from Google Cloud Storage.

**Landmarks**
SF Open Data Portal — Landmarks dataset
https://data.sfgov.org/Geographic-Locations-and-Boundaries/Landmarks/rzic-39gi/about_data

**Basemap**
CARTO Dark Matter vector tile style.

---

## Tech stack

| Layer | Library / Service |
|---|---|
| Framework | Vue 3 (TypeScript) |
| Build | Vite 6 |
| Map | MapLibre GL 4 |
| In-browser SQL | DuckDB WASM |
| State | Pinia |
| Routing | Vue Router 4 |
| Query language | Trilogy / PreQL (compiled server-side via trilogy-service) |
| AI chat | Claude claude-sonnet-4-6 via Anthropic API (user-supplied key) |
| Package manager | pnpm |

Data pipeline dependencies: Python 3.13, PyArrow, DuckDB, Pillow, instructor, google-genai.

---

## Repository

https://github.com/greenmtnboy/sf_tree_reporting
